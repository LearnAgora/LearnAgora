{% extends "LaLearnodexBundle::main.html.twig" %}

{% block head %}
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>

    <link href="{{ asset('bundles/lalearnodex/css/main.css', absolute=true) }}" rel="stylesheet" type="text/css" media="all" />
{% endblock %}

{% block container_class 'container-fluid' %}

{% block container %}
    <div id="viewport-area" class="row">
        <div id="sidebar" class="col-xs-12 col-md-3 col-md-push-9">
            {% block sidebar %}
                <div class="row">
                    <img id="sidebar-profile-picture" class="img-responsive img-circle center-block" src="{{ asset('https://addons.cdn.mozilla.net/static//img/zamboni/anon_user.png', absolute=true) }}" /><br />
                </div>

                <div class="row text-center">
                    <p class="lead"><strong>{{ app.user.username }}</strong></p>
                </div>

                <div class="row text-center">
                    <ul class="list-inline">
                        <li>
                            <a href="{{ path('homepage') }}">
                                <span class="glyphicon glyphicon-home lead"></span>
                            </a>
                        </li>
                        <li>
                            <a href="{{ path('fos_user_security_logout') }}">
                                <span class="glyphicon glyphicon-log-out lead"></span>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="row">
                    <div id="sidebar-dna-chart"></div>
                </div>

                <div id="sidebar-matches-section" class="row">
                    <table class="table table-hover table-condensed">
                        <thead>
                        <tr><th class="text-center">Personality matches</th></tr>
                        </thead>
                        <tbody>
                        {% for personaMatch in app.user.getPersonas() %}
                            <tr><td>{{ personaMatch.getPersona().getUser().getUserName() }} <span class="badge pull-right">{{ personaMatch.getMatch() |number_format(0) }}</span></td></tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endblock %}
        </div>

        <div id="content-area" class="col-xs-12 col-md-9 col-md-pull-3">
            {% block Main %}{% endblock %}
        </div>
    </div>
{% endblock %}

{% block scripts %}

<script type="text/javascript">
    google.load("visualization", "1", {packages:["corechart"]});
    google.setOnLoadCallback(drawSidebarDNA);

    function drawSidebarDNA() {
        var barStyle = 'color: #606060';

        var data = google.visualization.arrayToDataTable([
            ['Tag', 'Value', { role: 'style'}]
            {% set count, maxTags = 0, 8 %}
            {% if app.user %}
                {% for affinity in app.user.getAffinities() if count < maxTags %}
                    ,['{{ affinity.getAgora().getName() }}', {{ affinity.getValue() |number_format(0) }}, barStyle]
                    {% set count = count + 1 %}
                {% endfor %}
            {% endif %}

            {% for i in count..maxTags %}
                ,['Empty', 0, barStyle]
            {% endfor %}
        ]);

        var options = {
            backgroundColor: 'transparent',
            legend: { position: 'none' },
            animation: {
                duration: 500,
                easing: 'out'
            },
            hAxis: { textPosition: 'none' },
            vAxis: {
                textPosition: 'none',
                gridlines: {
                    color: 'transparent'
                }
            },
            tooltip: { isHtml: true },
            enableInteractivity: true
        };

        var chart = new google.visualization.ColumnChart(document.getElementById('sidebar-dna-chart'));
        chart.draw(data, options);
    }

    $(window).resize(function() { drawSidebarDNA(); });
</script>

{% endblock %}
